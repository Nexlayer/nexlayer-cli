{
  "version": "1.0",
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Nexlayer YAML Template Schema",
    "description": "Schema for Nexlayer YAML templates used to deploy full-stack applications on Nexlayer Cloud.",
    "type": "object",
    "required": ["application"],
    "properties": {
      "application": {
        "type": "object",
        "required": ["name", "pods"],
        "properties": {
          "name": {
            "type": "string",
            "description": "The unique name of your deployment."
          },
          "url": {
            "type": "string",
            "description": "Permanent domain for this deployment (optional)."
          },
          "registryLogin": {
            "type": "object",
            "required": ["registry", "username", "personalAccessToken"],
            "description": "Authentication details for private container registries (optional).",
            "properties": {
              "registry": {
                "type": "string",
                "description": "Private registry (e.g., 'ghcr.io/my-org')."
              },
              "username": {
                "type": "string",
                "description": "Authentication username."
              },
              "personalAccessToken": {
                "type": "string",
                "description": "Read-only access token for secure authentication."
              }
            }
          },
          "pods": {
            "type": "array",
            "minItems": 1,
            "description": "List of services (pods) that make up this application.",
            "items": {
              "type": "object",
              "required": ["name", "image"],
              "properties": {
                "name": {
                  "type": "string",
                  "pattern": "^[a-z][a-z0-9\\.\\-]*$",
                  "description": "Unique pod name (lowercase, alphanumeric, '-', or '.')."
                },
                "path": {
                  "type": "string",
                  "description": "URL path where this pod is accessible (optional)."
                },
                "image": {
                  "type": "string",
                  "description": "Docker image reference (supports <% REGISTRY %> for private images)."
                },
                "volumes": {
                  "type": "array",
                  "description": "Persistent storage volumes (optional).",
                  "items": {
                    "type": "object",
                    "required": ["name", "size", "mountPath"],
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Unique volume name."
                      },
                      "size": {
                        "type": "string",
                        "description": "Storage size (e.g., '1Gi')."
                      },
                      "mountPath": {
                        "type": "string",
                        "description": "Path inside the container."
                      }
                    }
                  }
                },
                "secrets": {
                  "type": "array",
                  "description": "Encrypted credentials or configuration files (optional).",
                  "items": {
                    "type": "object",
                    "required": ["name", "data", "mountPath", "fileName"],
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Secret name."
                      },
                      "data": {
                        "type": "string",
                        "description": "Raw or Base64-encoded secret content."
                      },
                      "mountPath": {
                        "type": "string",
                        "description": "Directory where the secret is stored."
                      },
                      "fileName": {
                        "type": "string",
                        "description": "Name of the secret file."
                      }
                    }
                  }
                },
                "vars": {
                  "type": "array",
                  "description": "Environment variables required by this pod (optional).",
                  "items": {
                    "type": "object",
                    "required": ["key", "value"],
                    "properties": {
                      "key": {
                        "type": "string",
                        "description": "Environment variable key."
                      },
                      "value": {
                        "type": "string",
                        "description": "Environment variable value."
                      }
                    }
                  }
                },
                "servicePorts": {
                  "type": "array",
                  "description": "List of ports that this pod exposes (optional).",
                  "items": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 65535,
                    "description": "Port number (e.g., 3000, 5432)."
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
